<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jurnal Digital Guru BK</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .floating-header {
      animation: fadeInDown 0.6s ease-out;
    }
    
    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .table-container {
      overflow-x: auto;
    }
    
    .loading-spinner {
      border: 3px solid rgba(34, 197, 94, 0.3);
      border-radius: 50%;
      border-top: 3px solid #22c55e;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .fade-in {
      animation: fadeIn 0.4s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .modal-backdrop {
      backdrop-filter: blur(4px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .modal-content {
      animation: slideUpBounce 0.5s ease-out;
    }
    
    @keyframes slideUpBounce {
      0% {
        opacity: 0;
        transform: translateY(100px) scale(0.8);
      }
      50% {
        transform: translateY(-10px) scale(1.02);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    .modal-exit {
      animation: slideDownFade 0.3s ease-in;
    }
    
    @keyframes slideDownFade {
      from {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      to {
        opacity: 0;
        transform: translateY(50px) scale(0.9);
      }
    }
    
    /* Mobile Responsive Styles */
    @media (max-width: 768px) {
      .floating-header {
        border-radius: 0.75rem;
        margin: 1rem;
        padding: 1rem 0.75rem;
      }
      
      .floating-header h1 {
        font-size: 1rem;
        line-height: 1.25;
      }
      
      .floating-header p {
        font-size: 0.75rem;
      }
      
      #logout-btn {
        position: static;
        transform: none;
        width: 100%;
        margin-top: 0.75rem;
        padding: 0.5rem;
      }
      
      .tab-button {
        font-size: 0.75rem;
        padding: 0.75rem 0.5rem;
      }
      
      .tab-button i {
        display: block;
        margin: 0 auto 0.25rem;
      }
      
      /* Make table cards on mobile */
      .table-container table {
        display: none;
      }
      
      .mobile-card-view {
        display: block;
      }
      
      .modal-content {
        max-height: 85%;
      }
      
      /* Stack pagination buttons */
      #pagination {
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      
      #pagination button {
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
      }
    }
    
    @media (min-width: 769px) {
      .mobile-card-view {
        display: none;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full w-full bg-gradient-to-br from-green-50 to-emerald-50"><!-- Login Screen -->
  <div id="login-screen" class="h-full w-full flex items-center justify-center p-4">
   <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden"><!-- Login Header -->
    <div class="bg-gradient-to-r from-green-600 to-emerald-600 text-white px-8 py-10 text-center">
     <div class="bg-white bg-opacity-20 rounded-full p-4 w-20 h-20 mx-auto mb-4 flex items-center justify-center"><i class="fas fa-clipboard-list text-4xl"></i>
     </div>
     <h1 class="text-2xl font-bold mb-2">Selamat Datang</h1>
     <p class="text-sm opacity-90">Jurnal Digital Guru BK</p>
    </div><!-- Login Body -->
    <div class="px-8 py-6">
     <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded mb-6">
      <p class="text-sm text-green-800 leading-relaxed"><i class="fas fa-info-circle mr-2"></i> Aplikasi pencatatan dan monitoring aktivitas bimbingan konseling di sekolah secara digital dan real-time.</p>
     </div>
     <form id="login-form">
      <div class="mb-6"><label for="login-password" class="block text-sm font-medium text-gray-700 mb-2"> <i class="fas fa-lock mr-2"></i>Masukkan Password </label> <input type="password" id="login-password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Masukkan password Anda" required>
      </div><button type="submit" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white px-6 py-3 rounded-lg font-semibold transition-all transform hover:scale-105 shadow-lg"> <i class="fas fa-sign-in-alt mr-2"></i>Masuk </button>
     </form>
     <div id="login-error" class="hidden mt-4 bg-red-50 border-l-4 border-red-500 p-3 rounded">
      <p class="text-sm text-red-800"><i class="fas fa-exclamation-circle mr-2"></i>Password salah! Silakan coba lagi.</p>
     </div>
     <div class="mt-6 text-center">
      <p class="text-xs text-gray-500">Password default: <span class="font-mono font-semibold">123456</span></p>
      <p class="text-xs text-gray-500 mt-1">Anda dapat mengubah password di menu Pengaturan</p>
     </div>
    </div>
   </div>
  </div><!-- Main App (Hidden by default) -->
  <div id="main-app" class="h-full w-full overflow-auto hidden"><!-- Floating Header -->
   <div class="floating-header bg-green-600 rounded-full mx-auto mt-6 px-8 py-4 shadow-xl max-w-2xl text-center relative">
    <h1 id="app-title" class="text-white text-2xl font-bold">JURNAL DIGITAL GURU BK</h1>
    <p id="current-date" class="text-white text-sm mt-2 opacity-90"></p><button id="logout-btn" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-full text-sm font-medium transition-all" title="Logout"> <i class="fas fa-sign-out-alt mr-2"></i>Keluar </button>
   </div><!-- Main Container -->
   <div class="max-w-7xl mx-auto px-4 py-8"><!-- Tab Navigation -->
    <div class="bg-white rounded-lg shadow-md mb-6">
     <div class="flex justify-center border-b border-gray-200 flex-wrap"><button id="tab-isi-jurnal" class="tab-button px-6 py-3 font-semibold text-green-600 border-b-2 border-green-600 transition-all"> <i class="fas fa-edit mr-2"></i>Isi Jurnal </button> <button id="tab-jurnal" class="tab-button px-6 py-3 font-semibold text-gray-500 hover:text-green-600 transition-all"> <i class="fas fa-book mr-2"></i>Jurnal Digital </button> <button id="tab-infografis" class="tab-button px-6 py-3 font-semibold text-gray-500 hover:text-green-600 transition-all"> <i class="fas fa-chart-bar mr-2"></i>Infografis </button> <button id="tab-pengaturan" class="tab-button px-6 py-3 font-semibold text-gray-500 hover:text-green-600 transition-all"> <i class="fas fa-cog mr-2"></i>Pengaturan </button>
     </div>
    </div><!-- Content Panels --> <!-- Isi Jurnal Panel -->
    <div id="panel-isi-jurnal" class="content-panel">
     <div class="bg-white rounded-lg shadow-md p-8">
      <div class="text-center mb-8">
       <div class="bg-gradient-to-br from-green-100 to-emerald-100 rounded-full p-8 w-32 h-32 mx-auto mb-6 flex items-center justify-center shadow-lg"><i class="fas fa-pen-fancy text-green-600 text-6xl"></i>
       </div>
       <h2 class="text-3xl font-bold text-gray-800 mb-3">Isi Jurnal Bimbingan dan Konseling</h2>
       <p class="text-gray-600 text-lg">Klik tombol di bawah untuk membuka formulir jurnal BK</p>
      </div>
      <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-8 border-2 border-green-200 text-center">
       <div class="mb-6"><i class="fas fa-clipboard-list text-green-600 text-5xl mb-4"></i>
        <h3 class="text-xl font-bold text-gray-800 mb-2">Formulir Jurnal Digital</h3>
        <p class="text-gray-600 mb-6">Formulir akan terbuka di tab baru agar Anda dapat mengisi dengan lebih leluasa</p>
       </div><a href="https://docs.google.com/forms/d/e/1FAIpQLSd3OCqMEyyUEjrWPoH-AKOnFRqFpe_RVwrpHy2DVxyrwGBG0w/viewform" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white px-8 py-4 rounded-lg font-bold text-lg transition-all transform hover:scale-105 shadow-lg"> <i class="fas fa-external-link-alt text-xl"></i> <span>Buka Formulir Jurnal</span> </a>
       <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-white rounded-lg p-4 shadow-sm"><i class="fas fa-clock text-green-600 text-2xl mb-2"></i>
         <p class="text-sm font-semibold text-gray-700">Cepat &amp; Mudah</p>
         <p class="text-xs text-gray-600 mt-1">Isi formulir dalam hitungan menit</p>
        </div>
        <div class="bg-white rounded-lg p-4 shadow-sm"><i class="fas fa-save text-green-600 text-2xl mb-2"></i>
         <p class="text-sm font-semibold text-gray-700">Otomatis Tersimpan</p>
         <p class="text-xs text-gray-600 mt-1">Data langsung masuk ke sistem</p>
        </div>
        <div class="bg-white rounded-lg p-4 shadow-sm"><i class="fas fa-shield-alt text-green-600 text-2xl mb-2"></i>
         <p class="text-sm font-semibold text-gray-700">Aman &amp; Terpercaya</p>
         <p class="text-xs text-gray-600 mt-1">Data tersimpan dengan aman</p>
        </div>
       </div>
      </div>
      <div class="mt-6 bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg">
       <div class="flex items-start"><i class="fas fa-info-circle text-blue-500 text-xl mr-3 mt-1"></i>
        <div>
         <p class="text-sm text-blue-800 font-semibold mb-1">Informasi:</p>
         <p class="text-sm text-blue-700">Setelah mengisi formulir, tutup tab formulir dan kembali ke halaman ini. Data Anda akan otomatis muncul di tab <strong>Jurnal Digital</strong>. Anda dapat melihat, mengedit, dan mencetak jurnal yang sudah tersimpan.</p>
        </div>
       </div>
      </div>
      <div class="mt-6 bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-lg">
       <div class="flex items-start"><i class="fas fa-lightbulb text-yellow-500 text-xl mr-3 mt-1"></i>
        <div>
         <p class="text-sm text-yellow-800 font-semibold mb-1">Tips:</p>
         <p class="text-sm text-yellow-700">Pastikan Anda sudah login ke akun Google untuk dapat mengisi formulir. Jika formulir tidak terbuka, periksa popup blocker browser Anda.</p>
        </div>
       </div>
      </div>
     </div>
    </div>
    <div id="panel-jurnal" class="content-panel hidden"><!-- Filter Section -->
     <div class="bg-white rounded-lg shadow-md p-6 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Tanggal Mulai</label> <input type="date" id="date-start" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
       </div>
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Tanggal Akhir</label> <input type="date" id="date-end" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
       </div>
      </div>
      <div class="flex gap-2"><button id="apply-filter" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"> <i class="fas fa-filter mr-2"></i>Terapkan Filter </button> <button id="reset-filter" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors"> <i class="fas fa-redo mr-2"></i>Reset </button>
      </div>
     </div><!-- Table Controls -->
     <div class="bg-white rounded-lg shadow-md p-4 mb-6 flex justify-between items-center flex-wrap gap-4">
      <div class="flex items-center gap-2"><label class="text-sm font-medium text-gray-700">Tampilkan:</label> <select id="rows-per-page" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"> <option value="5">5</option> <option value="10" selected>10</option> <option value="20">20</option> <option value="50">50</option> <option value="100">100</option> <option value="all">Semua</option> </select> <span class="text-sm text-gray-600">data</span>
      </div>
      <div id="pagination-info" class="text-sm text-gray-600"></div>
     </div><!-- Loading State -->
     <div id="loading" class="flex justify-center items-center py-12">
      <div class="loading-spinner"></div>
     </div><!-- Table -->
     <div id="table-wrapper" class="bg-white rounded-lg shadow-md overflow-hidden hidden">
      <div class="table-container">
       <table class="w-full">
        <thead class="bg-green-600 text-white">
         <tr id="table-header"></tr>
        </thead>
        <tbody id="table-body" class="divide-y divide-gray-200"></tbody>
       </table>
      </div><!-- Mobile Card View -->
      <div id="mobile-card-view" class="mobile-card-view p-4 space-y-4"></div>
     </div><!-- Pagination -->
     <div id="pagination" class="mt-6 flex justify-center gap-2"></div>
    </div><!-- Infografis Panel -->
    <div id="panel-infografis" class="content-panel hidden">
     <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Statistik Jurnal</h2><!-- Date Range Filter for Infografis -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Tanggal Mulai</label> <input type="date" id="info-date-start" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
       </div>
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Tanggal Akhir</label> <input type="date" id="info-date-end" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
       </div>
       <div class="flex items-end"><button id="update-infografis" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"> <i class="fas fa-sync-alt mr-2"></i>Update </button>
       </div>
      </div><!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
       <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-lg p-6 text-white shadow-lg">
        <div class="flex items-center justify-between">
         <div>
          <p class="text-sm opacity-90">Total Jurnal</p>
          <p id="total-entries" class="text-3xl font-bold mt-1">0</p>
         </div><i class="fas fa-book text-4xl opacity-80"></i>
        </div>
       </div>
       <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg p-6 text-white shadow-lg">
        <div class="flex items-center justify-between">
         <div>
          <p class="text-sm opacity-90">Rata-rata per Hari</p>
          <p id="avg-per-day" class="text-3xl font-bold mt-1">0</p>
         </div><i class="fas fa-calendar-day text-4xl opacity-80"></i>
        </div>
       </div>
       <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg p-6 text-white shadow-lg">
        <div class="flex items-center justify-between">
         <div>
          <p class="text-sm opacity-90">Hari dengan Jurnal</p>
          <p id="days-with-entries" class="text-3xl font-bold mt-1">0</p>
         </div><i class="fas fa-calendar-check text-4xl opacity-80"></i>
        </div>
       </div>
      </div><!-- Daily Chart -->
      <div class="bg-gray-50 rounded-lg p-6">
       <h3 class="text-lg font-semibold text-gray-800 mb-4">Jurnal per Hari</h3>
       <div id="daily-chart" class="space-y-2"></div>
      </div>
     </div>
    </div><!-- Pengaturan Panel -->
    <div id="panel-pengaturan" class="content-panel hidden">
     <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Pengaturan</h2>
      <div class="space-y-6">
       <div>
        <h3 class="text-lg font-semibold text-gray-700 mb-3 text-center">Data Sekolah</h3>
        <div id="school-data-display" class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-lg border-2 border-green-200">
         <div class="text-center text-gray-500 py-8"><i class="fas fa-school text-4xl mb-3"></i>
          <p>Data sekolah belum diisi</p><button id="add-school-data" class="mt-4 bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium transition-colors"> <i class="fas fa-plus mr-2"></i>Tambah Data Sekolah </button>
         </div>
        </div>
       </div>
       <div>
        <h3 class="text-lg font-semibold text-gray-700 mb-3 text-center">Keamanan</h3>
        <div class="bg-gray-50 p-4 rounded-lg">
         <p class="text-sm text-gray-600 mb-3">Ubah Password Aplikasi</p>
         <div class="space-y-3">
          <div><label class="block text-xs font-medium text-gray-700 mb-1">Password Saat Ini</label> <input type="password" id="current-password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm" placeholder="Masukkan password saat ini">
          </div>
          <div><label class="block text-xs font-medium text-gray-700 mb-1">Password Baru</label> <input type="password" id="new-password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm" placeholder="Masukkan password baru">
          </div>
          <div><label class="block text-xs font-medium text-gray-700 mb-1">Konfirmasi Password Baru</label> <input type="password" id="confirm-password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm" placeholder="Konfirmasi password baru">
          </div><button id="change-password-btn" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm"> <i class="fas fa-key mr-2"></i>Ubah Password </button>
         </div>
        </div>
       </div>
       <div>
        <h3 class="text-lg font-semibold text-gray-700 mb-3 text-center">Sumber Data</h3>
        <div class="bg-gray-50 p-4 rounded-lg">
         <p class="text-sm text-gray-600 mb-2">URL Google Spreadsheet:</p>
         <p class="text-xs text-gray-500 break-all font-mono bg-white p-2 rounded border border-gray-200">Mappaguru Online - Jurnal Digital Guru BK</p>
        </div>
       </div>
       <div>
        <h3 class="text-lg font-semibold text-gray-700 mb-3 text-center">Informasi Aplikasi</h3>
        <div class="bg-gray-50 p-4 rounded-lg space-y-2">
         <p class="text-sm text-center"><span class="font-medium">Versi:</span> 1.0.0</p>
         <p class="text-sm text-center"><span class="font-medium">Pengembang:</span> <span id="footer-dev-name">Muhammad Hasratul</span></p>
         <p class="text-sm text-center"><span class="font-medium">Tahun:</span> <span id="current-year"></span></p>
        </div>
       </div>
       <div>
        <h3 class="text-lg font-semibold text-gray-700 mb-3 text-center">Tentang</h3>
        <div class="bg-gray-50 p-4 rounded-lg">
         <p class="text-sm text-gray-600 text-center">Aplikasi Jurnal Digital Guru BK dirancang untuk memudahkan pencatatan dan monitoring aktivitas bimbingan konseling di sekolah. Data tersimpan secara real-time di Google Spreadsheet dan dapat diakses kapan saja.</p>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Footer -->
   <footer class="bg-green-600 text-white py-4 mt-12">
    <div class="max-w-7xl mx-auto px-4 text-center">
     <p class="text-sm">© <span id="footer-year"></span> Dikembangkan oleh <span id="footer-developer" class="font-semibold">Muhammad Hasratul</span></p>
    </div>
   </footer><!-- Detail Modal -->
   <div id="detail-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50 p-4">
    <div class="modal-content bg-white rounded-lg shadow-2xl max-w-4xl w-full max-h-[90%] overflow-hidden flex flex-col">
     <div class="bg-gradient-to-r from-green-600 to-emerald-600 text-white px-6 py-5 flex justify-between items-center">
      <div class="flex items-center gap-3">
       <div class="bg-white bg-opacity-20 rounded-full p-3"><i class="fas fa-file-alt text-2xl"></i>
       </div>
       <div>
        <h3 class="text-xl font-bold">Detail Jurnal Bimbingan dan Konseling</h3>
        <p class="text-sm opacity-90 mt-1">Informasi lengkap jurnal aktivitas BK</p>
       </div>
      </div><button id="close-detail" class="text-white hover:text-gray-200 text-3xl leading-none transition-transform hover:scale-110">×</button>
     </div>
     <div id="detail-content" class="p-6 overflow-auto flex-1"></div>
     <div class="border-t border-gray-200 bg-gray-50 px-6 py-4 flex gap-3"><button id="print-detail-pdf" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2"> <i class="fas fa-file-pdf text-lg"></i> <span>Cetak PDF</span> </button> <button id="back-detail" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2"> <i class="fas fa-arrow-left text-lg"></i> <span>Kembali</span> </button>
     </div>
    </div>
   </div><!-- School Data Modal -->
   <div id="school-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90%] overflow-auto">
     <div class="bg-green-600 text-white px-6 py-4 flex justify-between items-center rounded-t-lg">
      <h3 class="text-xl font-bold"><i class="fas fa-school mr-2"></i>Data Sekolah</h3><button id="close-school-modal" class="text-white hover:text-gray-200 text-2xl leading-none">×</button>
     </div>
     <div class="p-6">
      <div class="space-y-4">
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Nama Sekolah</label> <input type="text" id="school-name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Contoh: SMA Negeri 1 Jakarta">
       </div>
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Nama Kepala Sekolah</label> <input type="text" id="school-principal" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Contoh: Dr. Budi Santoso, M.Pd">
       </div>
       <div><label class="block text-sm font-medium text-gray-700 mb-2">NIP Kepala Sekolah</label> <input type="text" id="school-principal-nip" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Contoh: 196501011990031001">
       </div>
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Nama Guru BK</label> <input type="text" id="school-counselor" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Contoh: Sri Rahayu, S.Pd">
       </div>
       <div><label class="block text-sm font-medium text-gray-700 mb-2">NIP Guru BK</label> <input type="text" id="school-counselor-nip" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Contoh: 197803152006042001">
       </div>
      </div>
     </div>
     <div class="px-6 pb-6 flex gap-3"><button id="save-school-data" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"> <i class="fas fa-save mr-2"></i>Simpan </button> <button id="cancel-school-modal" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors"> <i class="fas fa-times mr-2"></i>Batal </button>
     </div>
    </div>
   </div><!-- Edit Modal -->
   <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-3xl w-full max-h-[90%] overflow-auto">
     <div class="bg-green-600 text-white px-6 py-4 flex justify-between items-center rounded-t-lg">
      <h3 class="text-xl font-bold">Edit Jurnal</h3><button id="close-edit" class="text-white hover:text-gray-200 text-2xl leading-none">×</button>
     </div>
     <div id="edit-content" class="p-6"></div>
     <div class="px-6 pb-6 flex gap-3"><button id="save-edit" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"> <i class="fas fa-save mr-2"></i>Simpan </button> <button id="cancel-edit" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors"> <i class="fas fa-times mr-2"></i>Batal </button>
     </div>
    </div>
   </div>
  </div>
  <script>
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR46LnuP0YLQyTZegGRPyDAN0Ckr_HsASgf46BSRmFp1f277dncbO07EBlXbUhqEMwdp3TS_8Veg_zw/pub?gid=898068849&single=true&output=csv';
    
    let allData = [];
    let filteredData = [];
    let headers = [];
    let currentPage = 1;
    let rowsPerPage = 10;
    let currentEditIndex = -1;
    let currentSchoolData = null;
    let isLoggedIn = false;
    
    // Password Management
    function getPassword() {
      return localStorage.getItem('appPassword') || '123456';
    }
    
    function setPassword(newPassword) {
      localStorage.setItem('appPassword', newPassword);
    }
    
    // Check if already logged in (session storage)
    function checkLoginStatus() {
      return sessionStorage.getItem('isLoggedIn') === 'true';
    }
    
    function setLoginStatus(status) {
      sessionStorage.setItem('isLoggedIn', status ? 'true' : 'false');
      isLoggedIn = status;
    }
    
    // Login Form Handler
    document.getElementById('login-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const enteredPassword = document.getElementById('login-password').value;
      const correctPassword = getPassword();
      
      if (enteredPassword === correctPassword) {
        setLoginStatus(true);
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('main-app').classList.remove('hidden');
        document.getElementById('login-error').classList.add('hidden');
      } else {
        document.getElementById('login-error').classList.remove('hidden');
        document.getElementById('login-password').value = '';
        document.getElementById('login-password').focus();
      }
    });
    
    // Change Password Handler
    document.getElementById('change-password-btn').addEventListener('click', function() {
      const currentPassword = document.getElementById('current-password').value;
      const newPassword = document.getElementById('new-password').value;
      const confirmPassword = document.getElementById('confirm-password').value;
      
      if (!currentPassword || !newPassword || !confirmPassword) {
        showToast('Semua field harus diisi', 'error');
        return;
      }
      
      if (currentPassword !== getPassword()) {
        showToast('Password saat ini salah', 'error');
        return;
      }
      
      if (newPassword.length < 6) {
        showToast('Password baru minimal 6 karakter', 'error');
        return;
      }
      
      if (newPassword !== confirmPassword) {
        showToast('Password baru dan konfirmasi tidak cocok', 'error');
        return;
      }
      
      setPassword(newPassword);
      document.getElementById('current-password').value = '';
      document.getElementById('new-password').value = '';
      document.getElementById('confirm-password').value = '';
      
      showToast('Password berhasil diubah', 'success');
    });
    
    // Check login on page load
    if (checkLoginStatus()) {
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('main-app').classList.remove('hidden');
      isLoggedIn = true;
    }
    
    // Logout Handler
    document.getElementById('logout-btn').addEventListener('click', function() {
      const confirmDiv = document.createElement('div');
      confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
      confirmDiv.innerHTML = `
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-md mx-4">
          <div class="text-center mb-4">
            <i class="fas fa-sign-out-alt text-green-600 text-5xl mb-3"></i>
            <h3 class="text-xl font-bold text-gray-800 mb-2">Konfirmasi Logout</h3>
            <p class="text-gray-600">Apakah Anda yakin ingin keluar dari aplikasi?</p>
          </div>
          <div class="flex gap-3">
            <button id="confirm-logout-yes" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
              <i class="fas fa-check mr-2"></i>Ya, Keluar
            </button>
            <button id="confirm-logout-no" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
              <i class="fas fa-times mr-2"></i>Batal
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(confirmDiv);
      
      document.getElementById('confirm-logout-yes').addEventListener('click', () => {
        setLoginStatus(false);
        document.getElementById('main-app').classList.add('hidden');
        document.getElementById('login-screen').classList.remove('hidden');
        document.getElementById('login-password').value = '';
        document.getElementById('login-error').classList.add('hidden');
        confirmDiv.remove();
      });
      
      document.getElementById('confirm-logout-no').addEventListener('click', () => {
        confirmDiv.remove();
      });
    });
    
    // Load school data from localStorage
    function loadSchoolData() {
      const saved = localStorage.getItem('schoolData');
      if (saved) {
        currentSchoolData = JSON.parse(saved);
      }
      renderSchoolData();
    }
    
    // Save school data to localStorage
    function saveSchoolDataToStorage(data) {
      localStorage.setItem('schoolData', JSON.stringify(data));
      currentSchoolData = data;
      renderSchoolData();
    }
    
    // Delete school data from localStorage
    function deleteSchoolDataFromStorage() {
      localStorage.removeItem('schoolData');
      currentSchoolData = null;
      renderSchoolData();
    }
    
    // Display columns will be set dynamically after loading data
    let displayColumns = [];

    const defaultConfig = {
      app_title: 'JURNAL DIGITAL GURU BK',
      footer_text: 'Muhammad Hasratul'
    };

    async function onConfigChange(config) {
      const appTitle = config.app_title || defaultConfig.app_title;
      const footerText = config.footer_text || defaultConfig.footer_text;
      
      document.getElementById('app-title').textContent = appTitle;
      document.getElementById('footer-developer').textContent = footerText;
      document.getElementById('footer-dev-name').textContent = footerText;
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ['app_title', config.app_title || defaultConfig.app_title],
        ['footer_text', config.footer_text || defaultConfig.footer_text]
      ]);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }



    // Render School Data
    function renderSchoolData() {
      const display = document.getElementById('school-data-display');
      
      if (!currentSchoolData) {
        display.innerHTML = `
          <div class="text-center text-gray-500 py-8">
            <i class="fas fa-school text-4xl mb-3"></i>
            <p>Data sekolah belum diisi</p>
            <button id="add-school-data" class="mt-4 bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
              <i class="fas fa-plus mr-2"></i>Tambah Data Sekolah
            </button>
          </div>
        `;
        document.getElementById('add-school-data').addEventListener('click', openSchoolModal);
      } else {
        display.innerHTML = `
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <p class="text-sm font-medium text-gray-600 mb-1">Nama Sekolah</p>
              <p class="text-base font-semibold text-gray-800">${currentSchoolData.nama_sekolah || '-'}</p>
            </div>
            <div>
              <p class="text-sm font-medium text-gray-600 mb-1">Nama Kepala Sekolah</p>
              <p class="text-base font-semibold text-gray-800">${currentSchoolData.nama_kepsek || '-'}</p>
            </div>
            <div>
              <p class="text-sm font-medium text-gray-600 mb-1">NIP Kepala Sekolah</p>
              <p class="text-base font-semibold text-gray-800">${currentSchoolData.nip_kepsek || '-'}</p>
            </div>
            <div>
              <p class="text-sm font-medium text-gray-600 mb-1">Nama Guru BK</p>
              <p class="text-base font-semibold text-gray-800">${currentSchoolData.nama_guru_bk || '-'}</p>
            </div>
            <div>
              <p class="text-sm font-medium text-gray-600 mb-1">NIP Guru BK</p>
              <p class="text-base font-semibold text-gray-800">${currentSchoolData.nip_guru_bk || '-'}</p>
            </div>
          </div>
          <div class="mt-4 flex gap-3">
            <button id="edit-school-data" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
              <i class="fas fa-edit mr-2"></i>Edit
            </button>
            <button id="delete-school-data" class="flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
              <i class="fas fa-trash mr-2"></i>Hapus
            </button>
          </div>
        `;
        document.getElementById('edit-school-data').addEventListener('click', openSchoolModal);
        document.getElementById('delete-school-data').addEventListener('click', deleteSchoolData);
      }
    }

    // Open School Modal
    function openSchoolModal() {
      if (currentSchoolData) {
        document.getElementById('school-name').value = currentSchoolData.nama_sekolah || '';
        document.getElementById('school-principal').value = currentSchoolData.nama_kepsek || '';
        document.getElementById('school-principal-nip').value = currentSchoolData.nip_kepsek || '';
        document.getElementById('school-counselor').value = currentSchoolData.nama_guru_bk || '';
        document.getElementById('school-counselor-nip').value = currentSchoolData.nip_guru_bk || '';
      } else {
        document.getElementById('school-name').value = '';
        document.getElementById('school-principal').value = '';
        document.getElementById('school-principal-nip').value = '';
        document.getElementById('school-counselor').value = '';
        document.getElementById('school-counselor-nip').value = '';
      }
      document.getElementById('school-modal').classList.remove('hidden');
    }

    // Save School Data
    function saveSchoolData() {
      const data = {
        nama_sekolah: document.getElementById('school-name').value,
        nama_kepsek: document.getElementById('school-principal').value,
        nip_kepsek: document.getElementById('school-principal-nip').value,
        nama_guru_bk: document.getElementById('school-counselor').value,
        nip_guru_bk: document.getElementById('school-counselor-nip').value
      };

      saveSchoolDataToStorage(data);
      document.getElementById('school-modal').classList.add('hidden');
      showToast('Data sekolah berhasil disimpan', 'success');
    }

    // Delete School Data
    function deleteSchoolData() {
      const confirmDiv = document.createElement('div');
      confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
      confirmDiv.innerHTML = `
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-md mx-4">
          <div class="text-center mb-4">
            <i class="fas fa-exclamation-triangle text-yellow-500 text-5xl mb-3"></i>
            <h3 class="text-xl font-bold text-gray-800 mb-2">Konfirmasi Hapus</h3>
            <p class="text-gray-600">Apakah Anda yakin ingin menghapus data sekolah?</p>
          </div>
          <div class="flex gap-3">
            <button id="confirm-delete-school-yes" class="flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
              <i class="fas fa-trash mr-2"></i>Ya, Hapus
            </button>
            <button id="confirm-delete-school-no" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
              <i class="fas fa-times mr-2"></i>Batal
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(confirmDiv);
      
      document.getElementById('confirm-delete-school-yes').addEventListener('click', () => {
        deleteSchoolDataFromStorage();
        showToast('Data sekolah berhasil dihapus', 'success');
        confirmDiv.remove();
      });
      
      document.getElementById('confirm-delete-school-no').addEventListener('click', () => {
        confirmDiv.remove();
      });
    }

    // Show Toast
    function showToast(message, type = 'success') {
      const bgColor = type === 'success' ? 'bg-green-600' : 'bg-red-600';
      const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
      
      const toast = document.createElement('div');
      toast.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50`;
      toast.innerHTML = `<i class="fas ${icon} mr-2"></i>${message}`;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // School Modal Event Listeners
    document.getElementById('close-school-modal').addEventListener('click', () => {
      document.getElementById('school-modal').classList.add('hidden');
    });

    document.getElementById('cancel-school-modal').addEventListener('click', () => {
      document.getElementById('school-modal').classList.add('hidden');
    });

    document.getElementById('save-school-data').addEventListener('click', saveSchoolData);

    // Set current year and date
    const currentYear = new Date().getFullYear();
    document.getElementById('footer-year').textContent = currentYear;
    document.getElementById('current-year').textContent = currentYear;
    
    // Set current date in header
    const today = new Date();
    const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
    const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
    const dayName = days[today.getDay()];
    const date = today.getDate();
    const monthName = months[today.getMonth()];
    const year = today.getFullYear();
    document.getElementById('current-date').textContent = `${dayName}, ${date} ${monthName} ${year}`;

    // Tab Navigation
    const tabs = {
      'tab-isi-jurnal': 'panel-isi-jurnal',
      'tab-jurnal': 'panel-jurnal',
      'tab-infografis': 'panel-infografis',
      'tab-pengaturan': 'panel-pengaturan'
    };

    Object.keys(tabs).forEach(tabId => {
      document.getElementById(tabId).addEventListener('click', () => {
        document.querySelectorAll('.tab-button').forEach(btn => {
          btn.classList.remove('text-green-600', 'border-b-2', 'border-green-600');
          btn.classList.add('text-gray-500');
        });
        document.querySelectorAll('.content-panel').forEach(panel => {
          panel.classList.add('hidden');
        });
        
        document.getElementById(tabId).classList.remove('text-gray-500');
        document.getElementById(tabId).classList.add('text-green-600', 'border-b-2', 'border-green-600');
        document.getElementById(tabs[tabId]).classList.remove('hidden');
        
        if (tabId === 'tab-infografis') {
          updateInfografis();
        }
      });
    });

    // Parse CSV
    function parseCSV(csv) {
      const lines = csv.split('\n').filter(line => line.trim());
      const result = [];
      
      for (let i = 0; i < lines.length; i++) {
        const values = [];
        let current = '';
        let inQuotes = false;
        
        for (let j = 0; j < lines[i].length; j++) {
          const char = lines[i][j];
          
          if (char === '"') {
            inQuotes = !inQuotes;
          } else if (char === ',' && !inQuotes) {
            // Clean up the value by removing extra quotes
            let cleanValue = current.trim();
            if (cleanValue.startsWith('"') && cleanValue.endsWith('"')) {
              cleanValue = cleanValue.slice(1, -1);
            }
            values.push(cleanValue);
            current = '';
          } else {
            current += char;
          }
        }
        // Process the last value
        let cleanValue = current.trim();
        if (cleanValue.startsWith('"') && cleanValue.endsWith('"')) {
          cleanValue = cleanValue.slice(1, -1);
        }
        values.push(cleanValue);
        result.push(values);
      }
      
      return result;
    }

    // Load Data
    async function loadData() {
      try {
        const response = await fetch(CSV_URL);
        const csv = await response.text();
        const rows = parseCSV(csv);
        
        headers = rows[0];
        
        // Set display columns dynamically - show first 6 columns from the actual data
        displayColumns = headers.slice(0, 6);
        
        allData = rows.slice(1).map((row, index) => {
          const obj = { _index: index };
          headers.forEach((header, i) => {
            obj[header] = row[i] || '';
          });
          return obj;
        });
        
        filteredData = [...allData];
        
        renderTable();
        
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('table-wrapper').classList.remove('hidden');
      } catch (error) {
        document.getElementById('loading').innerHTML = `
          <div class="text-center text-red-600">
            <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
            <p class="font-semibold">Gagal memuat data</p>
            <p class="text-sm">Periksa koneksi internet Anda</p>
          </div>
        `;
      }
    }



    // Render Table
    function renderTable() {
      const headerRow = document.getElementById('table-header');
      headerRow.innerHTML = '';
      
      displayColumns.forEach(col => {
        const th = document.createElement('th');
        th.className = 'px-4 py-3 text-left text-sm font-semibold';
        th.textContent = col;
        headerRow.appendChild(th);
      });
      
      const actionTh = document.createElement('th');
      actionTh.className = 'px-4 py-3 text-center text-sm font-semibold';
      actionTh.textContent = 'Aksi';
      headerRow.appendChild(actionTh);
      
      const tbody = document.getElementById('table-body');
      tbody.innerHTML = '';
      
      const start = rowsPerPage === 'all' ? 0 : (currentPage - 1) * rowsPerPage;
      const end = rowsPerPage === 'all' ? filteredData.length : start + rowsPerPage;
      const pageData = filteredData.slice(start, end);
      
      pageData.forEach((row, idx) => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-green-50 transition-colors fade-in';
        
        displayColumns.forEach(col => {
          const td = document.createElement('td');
          td.className = 'px-4 py-3 text-sm text-gray-700';
          td.textContent = row[col] || '-';
          tr.appendChild(td);
        });
        
        const actionTd = document.createElement('td');
        actionTd.className = 'px-4 py-3 text-center';
        actionTd.innerHTML = `
          <button onclick="showDetail(${start + idx})" class="text-blue-600 hover:text-blue-800 mx-1" title="Detail">
            <i class="fas fa-eye"></i>
          </button>
          <button onclick="downloadPDF(${start + idx})" class="text-purple-600 hover:text-purple-800 mx-1" title="Unduh PDF">
            <i class="fas fa-file-pdf"></i>
          </button>
          <button onclick="showEdit(${start + idx})" class="text-green-600 hover:text-green-800 mx-1" title="Edit">
            <i class="fas fa-edit"></i>
          </button>
          <button onclick="confirmDelete(${start + idx})" class="text-red-600 hover:text-red-800 mx-1" title="Hapus">
            <i class="fas fa-trash"></i>
          </button>
        `;
        tr.appendChild(actionTd);
        tbody.appendChild(tr);
      });
      
      // Render Mobile Card View
      renderMobileCards(pageData, start);
      
      updatePagination();
    }
    
    // Render Mobile Cards
    function renderMobileCards(pageData, start) {
      const mobileView = document.getElementById('mobile-card-view');
      mobileView.innerHTML = '';
      
      pageData.forEach((row, idx) => {
        const card = document.createElement('div');
        card.className = 'bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-4 border-2 border-green-200 shadow-sm';
        
        let cardContent = '';
        displayColumns.forEach(col => {
          const icon = getIconForHeader(col);
          cardContent += `
            <div class="flex items-start gap-2 mb-3">
              <i class="${icon} text-green-600 text-sm mt-1"></i>
              <div class="flex-1">
                <p class="text-xs font-semibold text-green-700 uppercase">${col}</p>
                <p class="text-sm text-gray-800 mt-1">${row[col] || '-'}</p>
              </div>
            </div>
          `;
        });
        
        cardContent += `
          <div class="flex gap-2 mt-4 pt-3 border-t border-green-200">
            <button onclick="showDetail(${start + idx})" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded text-xs font-medium">
              <i class="fas fa-eye mr-1"></i>Detail
            </button>
            <button onclick="downloadPDF(${start + idx})" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded text-xs font-medium">
              <i class="fas fa-file-pdf mr-1"></i>PDF
            </button>
          </div>
          <div class="flex gap-2 mt-2">
            <button onclick="showEdit(${start + idx})" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded text-xs font-medium">
              <i class="fas fa-edit mr-1"></i>Edit
            </button>
            <button onclick="confirmDelete(${start + idx})" class="flex-1 bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded text-xs font-medium">
              <i class="fas fa-trash mr-1"></i>Hapus
            </button>
          </div>
        `;
        
        card.innerHTML = cardContent;
        mobileView.appendChild(card);
      });
    }

    // Update Pagination
    function updatePagination() {
      const total = filteredData.length;
      const totalPages = rowsPerPage === 'all' ? 1 : Math.ceil(total / rowsPerPage);
      
      const start = rowsPerPage === 'all' ? 1 : (currentPage - 1) * rowsPerPage + 1;
      const end = rowsPerPage === 'all' ? total : Math.min(currentPage * rowsPerPage, total);
      
      document.getElementById('pagination-info').textContent = `Menampilkan ${start}-${end} dari ${total} data`;
      
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';
      
      if (rowsPerPage === 'all') return;
      
      const prevBtn = document.createElement('button');
      prevBtn.className = `px-3 py-1 rounded ${currentPage === 1 ? 'bg-gray-300 cursor-not-allowed' : 'bg-green-600 hover:bg-green-700 text-white'}`;
      prevBtn.textContent = '‹ Prev';
      prevBtn.disabled = currentPage === 1;
      prevBtn.onclick = () => {
        if (currentPage > 1) {
          currentPage--;
          renderTable();
        }
      };
      pagination.appendChild(prevBtn);
      
      const maxVisible = 5;
      let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
      let endPage = Math.min(totalPages, startPage + maxVisible - 1);
      
      if (endPage - startPage < maxVisible - 1) {
        startPage = Math.max(1, endPage - maxVisible + 1);
      }
      
      for (let i = startPage; i <= endPage; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.className = `px-3 py-1 rounded ${i === currentPage ? 'bg-green-600 text-white' : 'bg-gray-200 hover:bg-gray-300'}`;
        pageBtn.textContent = i;
        pageBtn.onclick = () => {
          currentPage = i;
          renderTable();
        };
        pagination.appendChild(pageBtn);
      }
      
      const nextBtn = document.createElement('button');
      nextBtn.className = `px-3 py-1 rounded ${currentPage === totalPages ? 'bg-gray-300 cursor-not-allowed' : 'bg-green-600 hover:bg-green-700 text-white'}`;
      nextBtn.textContent = 'Next ›';
      nextBtn.disabled = currentPage === totalPages;
      nextBtn.onclick = () => {
        if (currentPage < totalPages) {
          currentPage++;
          renderTable();
        }
      };
      pagination.appendChild(nextBtn);
    }

    // Show Detail
    window.showDetail = function(index) {
      const row = filteredData[index];
      const content = document.getElementById('detail-content');
      
      // Store current detail index for PDF printing
      window.currentDetailIndex = index;
      
      content.innerHTML = `
        <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6 mb-6 border-2 border-green-200">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            ${headers.map((header, idx) => {
              const icon = getIconForHeader(header);
              return `
                <div class="bg-white rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow" style="animation: fadeIn 0.4s ease-out ${idx * 0.05}s forwards; opacity: 0;">
                  <div class="flex items-start gap-3">
                    <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-500 rounded-lg flex items-center justify-center">
                      <i class="${icon} text-white text-lg"></i>
                    </div>
                    <div class="flex-1">
                      <p class="text-xs font-semibold text-green-700 mb-1 uppercase tracking-wide">${header}</p>
                      <p class="text-gray-800 font-medium leading-relaxed">${row[header] || '-'}</p>
                    </div>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        </div>
        
        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
          <div class="flex items-start">
            <i class="fas fa-info-circle text-blue-500 text-xl mr-3 mt-1"></i>
            <div>
              <p class="text-sm text-blue-800 font-semibold mb-1">Informasi</p>
              <p class="text-sm text-blue-700">Anda dapat mencetak jurnal ini dalam format PDF dengan menekan tombol "Cetak PDF" di bawah.</p>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('detail-modal').classList.remove('hidden');
    };
    
    function getIconForHeader(header) {
      const iconMap = {
        'Tanggal': 'fas fa-calendar',
        'Jam Pelajaran': 'fas fa-clock',
        'Waktu': 'fas fa-hourglass-half',
        'Sasaran Layanan': 'fas fa-users',
        'Kelas/Status': 'fas fa-school',
        'Jenis Layanan': 'fas fa-hand-holding-heart',
        'Materi Layanan': 'fas fa-book-open',
        'Hasil': 'fas fa-check-circle',
        'Keterangan': 'fas fa-clipboard-list'
      };
      return iconMap[header] || 'fas fa-info-circle';
    }

    // Show Edit
    window.showEdit = function(index) {
      currentEditIndex = filteredData[index]._index;
      const row = allData[currentEditIndex];
      const content = document.getElementById('edit-content');
      content.innerHTML = '';
      
      headers.forEach((header, i) => {
        const div = document.createElement('div');
        div.className = 'mb-4';
        div.innerHTML = `
          <label class="block text-sm font-medium text-gray-700 mb-2">${header}</label>
          <input type="text" id="edit-field-${i}" value="${row[header] || ''}" 
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
        `;
        content.appendChild(div);
      });
      
      document.getElementById('edit-modal').classList.remove('hidden');
    };

    // Download PDF
    window.downloadPDF = function(index) {
      const { jsPDF } = window.jspdf;
      const row = filteredData[index];
      
      // Create PDF with Folio size (8.5 x 13 inches = 215.9 x 330.2 mm)
      const doc = new jsPDF({
        format: [215.9, 330.2]
      });
      
      // Header Box - Adjusted for Folio width
      doc.setFillColor(34, 197, 94);
      doc.rect(0, 0, 215.9, 35, 'F');
      
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(18);
      doc.setFont(undefined, 'bold');
      doc.text('JURNAL BIMBINGAN DAN KONSELING', 107.95, 15, { align: 'center' });
      
      // School name below title
      if (currentSchoolData && currentSchoolData.nama_sekolah) {
        doc.setFontSize(12);
        doc.setFont(undefined, 'bold');
        doc.text(currentSchoolData.nama_sekolah, 107.95, 25, { align: 'center' });
      }
      
      let yPos = 50;
      
      // Content area
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(10);
      
      const leftCol = 25;
      const colonX = 80;
      const valueX = 85;
      const lineSpacing = 7;
      const maxValueWidth = 105;
      
      headers.forEach(function(header) {
        const value = row[header] || '-';
        
        // Check if need new page
        if (yPos > 250) {
          doc.addPage();
          yPos = 20;
        }
        
        // Label (Bold)
        doc.setFont(undefined, 'bold');
        doc.text(header, leftCol, yPos);
        
        // Colon
        doc.text(':', colonX, yPos);
        
        // Value with text wrapping
        doc.setFont(undefined, 'normal');
        const lines = doc.splitTextToSize(value, maxValueWidth);
        doc.text(lines, valueX, yPos);
        
        yPos += lines.length * lineSpacing;
      });
      
      // Add signature section
      yPos += 20;
      
      // Check if signature fits on current page (Folio height is 330.2mm)
      if (yPos > 270) {
        doc.addPage();
        yPos = 30;
      }
      
      if (currentSchoolData) {
        // Signature boxes - Adjusted for Folio width
        const leftSigX = 55;
        const rightSigX = 160;
        
        // Left - Kepala Sekolah
        doc.setFontSize(10);
        doc.setFont(undefined, 'normal');
        doc.text('Mengetahui,', leftSigX, yPos, { align: 'center' });
        doc.text('Kepala Sekolah', leftSigX, yPos + 6, { align: 'center' });
        
        // Right - Guru BK
        doc.text('Yang Melaksanakan,', rightSigX, yPos, { align: 'center' });
        doc.text('Guru BK', rightSigX, yPos + 6, { align: 'center' });
        
        yPos += 30;
        
        // Names without underline
        doc.setFont(undefined, 'bold');
        doc.setFontSize(11);
        doc.text(currentSchoolData.nama_kepsek || '', leftSigX, yPos, { align: 'center' });
        doc.text(currentSchoolData.nama_guru_bk || '', rightSigX, yPos, { align: 'center' });
        
        // NIPs
        yPos += 6;
        doc.setFont(undefined, 'normal');
        doc.setFontSize(9);
        doc.text('NIP. ' + (currentSchoolData.nip_kepsek || '-'), leftSigX, yPos, { align: 'center' });
        doc.text('NIP. ' + (currentSchoolData.nip_guru_bk || '-'), rightSigX, yPos, { align: 'center' });
      }
      
      // Footer on last page - Adjusted for Folio height (330.2mm)
      const pageCount = doc.internal.getNumberOfPages();
      for (let i = 1; i <= pageCount; i++) {
        doc.setPage(i);
        doc.setFontSize(8);
        doc.setTextColor(150, 150, 150);
        doc.text('Halaman ' + i + ' dari ' + pageCount, 107.95, 320, { align: 'center' });
        doc.text('Dicetak dari Jurnal Digital Guru BK', 107.95, 325, { align: 'center' });
      }
      
      const filename = 'Jurnal_BK_' + (row['Tanggal'] ? row['Tanggal'].replace(/\//g, '-') : 'data') + '.pdf';
      doc.save(filename);
      
      showToast('PDF berhasil diunduh', 'success');
    };

    // Save Edit
    document.getElementById('save-edit').addEventListener('click', () => {
      headers.forEach((header, i) => {
        const input = document.getElementById(`edit-field-${i}`);
        if (input) {
          allData[currentEditIndex][header] = input.value;
        }
      });
      
      applyFilters();
      document.getElementById('edit-modal').classList.add('hidden');
      
      showToast('Data berhasil diupdate', 'success');
    });

    // Confirm Delete
    window.confirmDelete = function(index) {
      const row = filteredData[index];
      const actualIndex = row._index;
      
      const confirmDiv = document.createElement('div');
      confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
      confirmDiv.innerHTML = `
        <div class="bg-white rounded-lg shadow-2xl p-6 max-w-md mx-4">
          <div class="text-center mb-4">
            <i class="fas fa-exclamation-triangle text-yellow-500 text-5xl mb-3"></i>
            <h3 class="text-xl font-bold text-gray-800 mb-2">Konfirmasi Hapus</h3>
            <p class="text-gray-600">Apakah Anda yakin ingin menghapus data ini?</p>
          </div>
          <div class="flex gap-3">
            <button id="confirm-delete-yes" class="flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
              <i class="fas fa-trash mr-2"></i>Ya, Hapus
            </button>
            <button id="confirm-delete-no" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
              <i class="fas fa-times mr-2"></i>Batal
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(confirmDiv);
      
      document.getElementById('confirm-delete-yes').addEventListener('click', () => {
        allData.splice(actualIndex, 1);
        allData.forEach((item, idx) => item._index = idx);
        applyFilters();
        confirmDiv.remove();
        
        showToast('Data berhasil dihapus', 'error');
      });
      
      document.getElementById('confirm-delete-no').addEventListener('click', () => {
        confirmDiv.remove();
      });
    };

    // Apply Filters
    function applyFilters() {
      const dateStart = document.getElementById('date-start').value;
      const dateEnd = document.getElementById('date-end').value;
      
      filteredData = allData.filter(row => {
        let match = true;
        
        if (dateStart || dateEnd) {
          const rowDate = row['Tanggal'];
          if (rowDate) {
            const parts = rowDate.split('/');
            if (parts.length === 3) {
              const formattedDate = `${parts[2]}-${parts[1].padStart(2, '0')}-${parts[0].padStart(2, '0')}`;
              if (dateStart && formattedDate < dateStart) match = false;
              if (dateEnd && formattedDate > dateEnd) match = false;
            }
          }
        }
        
        return match;
      });
      
      currentPage = 1;
      renderTable();
    }

    // Event Listeners
    document.getElementById('apply-filter').addEventListener('click', applyFilters);
    
    document.getElementById('reset-filter').addEventListener('click', () => {
      document.getElementById('date-start').value = '';
      document.getElementById('date-end').value = '';
      filteredData = [...allData];
      currentPage = 1;
      renderTable();
    });
    
    document.getElementById('rows-per-page').addEventListener('change', (e) => {
      rowsPerPage = e.target.value === 'all' ? 'all' : parseInt(e.target.value);
      currentPage = 1;
      renderTable();
    });
    
    document.getElementById('close-detail').addEventListener('click', () => {
      const modal = document.getElementById('detail-modal');
      const modalContent = modal.querySelector('.modal-content');
      modalContent.classList.add('modal-exit');
      setTimeout(() => {
        modal.classList.add('hidden');
        modalContent.classList.remove('modal-exit');
      }, 300);
    });
    
    document.getElementById('back-detail').addEventListener('click', () => {
      const modal = document.getElementById('detail-modal');
      const modalContent = modal.querySelector('.modal-content');
      modalContent.classList.add('modal-exit');
      setTimeout(() => {
        modal.classList.add('hidden');
        modalContent.classList.remove('modal-exit');
      }, 300);
    });
    
    document.getElementById('print-detail-pdf').addEventListener('click', () => {
      if (window.currentDetailIndex !== undefined) {
        downloadPDF(window.currentDetailIndex);
      }
    });
    
    document.getElementById('close-edit').addEventListener('click', () => {
      document.getElementById('edit-modal').classList.add('hidden');
    });
    
    document.getElementById('cancel-edit').addEventListener('click', () => {
      document.getElementById('edit-modal').classList.add('hidden');
    });

    // Infografis
    function updateInfografis() {
      const dateStart = document.getElementById('info-date-start').value;
      const dateEnd = document.getElementById('info-date-end').value;
      
      let dataToAnalyze = [...allData];
      
      if (dateStart || dateEnd) {
        dataToAnalyze = allData.filter(row => {
          const rowDate = row['Tanggal'];
          if (!rowDate) return false;
          
          const parts = rowDate.split('/');
          if (parts.length !== 3) return false;
          
          const formattedDate = `${parts[2]}-${parts[1].padStart(2, '0')}-${parts[0].padStart(2, '0')}`;
          if (dateStart && formattedDate < dateStart) return false;
          if (dateEnd && formattedDate > dateEnd) return false;
          
          return true;
        });
      }
      
      const dailyCount = {};
      dataToAnalyze.forEach(row => {
        const date = row['Tanggal'];
        if (date) {
          dailyCount[date] = (dailyCount[date] || 0) + 1;
        }
      });
      
      const totalEntries = dataToAnalyze.length;
      const daysWithEntries = Object.keys(dailyCount).length;
      const avgPerDay = daysWithEntries > 0 ? (totalEntries / daysWithEntries).toFixed(1) : 0;
      
      document.getElementById('total-entries').textContent = totalEntries;
      document.getElementById('avg-per-day').textContent = avgPerDay;
      document.getElementById('days-with-entries').textContent = daysWithEntries;
      
      const chartContainer = document.getElementById('daily-chart');
      chartContainer.innerHTML = '';
      
      const sortedDates = Object.entries(dailyCount).sort((a, b) => {
        const dateA = a[0].split('/').reverse().join('-');
        const dateB = b[0].split('/').reverse().join('-');
        return dateB.localeCompare(dateA);
      }).slice(0, 15);
      
      const maxCount = Math.max(...sortedDates.map(([, count]) => count));
      
      sortedDates.forEach(([date, count]) => {
        const barWidth = (count / maxCount) * 100;
        const bar = document.createElement('div');
        bar.className = 'flex items-center gap-3';
        bar.innerHTML = `
          <span class="text-sm text-gray-600 w-24 flex-shrink-0">${date}</span>
          <div class="flex-1 bg-gray-200 rounded-full h-8 relative">
            <div class="bg-gradient-to-r from-green-500 to-green-600 h-8 rounded-full flex items-center justify-end pr-3 transition-all duration-500" 
                 style="width: ${barWidth}%">
              <span class="text-white font-semibold text-sm">${count}</span>
            </div>
          </div>
        `;
        chartContainer.appendChild(bar);
      });
    }
    
    document.getElementById('update-infografis').addEventListener('click', updateInfografis);

    // Initialize
    loadSchoolData();
    loadData();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9af5b07c13b4ab47',t:'MTc2NTk2Njg0Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>